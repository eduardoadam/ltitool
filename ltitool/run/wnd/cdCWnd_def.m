## -*- texinfo -*-
## @deftypefn  {} {} dummy()
##
## This is a dummy function documentation. This file have a lot functions
## and each one have a little documentation. This text is to avoid a warning when
## install this file as part of package.
## @end deftypefn
##
## Set the graphics toolkit and force read this file as script file (not a function file).
##
graphics_toolkit qt;
##


##
##
## Begin callbacks definitions 
##

## @deftypefn  {} {} btn_simulCDC_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_simulCDC control.
##
## @end deftypefn
function btn_simulCDC_doIt(source, callbackdata, cdCWnd)

%
% Plot step response of cascade control system
%

% global variable
global _ltitoolBasePath;

%  Load data
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCdata'])
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCsim'])

% ----------------------------------
% Step Response
% ----------------------------------
axes(cdCWnd.simulationCCD_image);
delay=0;
step_resp_CCD(Gp1,Gp2,Gv,Cint,Cext,Gm1,Gm2,GHint,Gt,delay,Gl1,Gl2, ...
              amplitud_sp,amplitud_l1,amplitud_l2,T_sp,T_l1,T_l2,TFinal, ...
              haChCons,haChCarga1,haChCarga2,1000);
grid on;
hold off

% Informacion adicional para la ventana principal
% ------------------------------------------------------------------------
[estabilidad,yinf,Test]=additionalinfoFB(GHext.num{1,1},GHext.den{1,1},amplitud_sp,TFinal,1000);
set(cdCWnd.label_Estabilidad, "String", num2str(estabilidad));
set(cdCWnd.valor_final, "String", num2str(yinf));
set(cdCWnd.tiempo_estab_GH, "String", num2str(Test));

% 
refresh();

end

## @deftypefn  {} {} btn_helpCDC_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_helpCDC control.
##
## @end deftypefn
function btn_helpCDC_doIt(source, callbackdata, cdCWnd)


%
% Run presentation to help  as html file.
%

% global variable
global _ltitoolBasePath;

% Load html file
url = ["file:" _ltitoolBasePath filesep() "ltitool_manual" filesep() "node21.html"];

  if(isunix())
    system(["xdg-open " url]);
  elseif (ispc())
    system(["start " url]);
  else
    disp(["I don't know how to open " url " in your os. Sorry!"]);
  endif;

end

## @deftypefn  {} {} btn_closeCCD_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_closeCCD control.
##
## @end deftypefn
function btn_closeCCD_doIt(source, callbackdata, cdCWnd)


% cierro ventana principal
close(cdCWnd.figure);

end

## @deftypefn  {} {} tiempo_estab_GH_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of tiempo_estab_GH control.
##
## @end deftypefn
function tiempo_estab_GH_doIt(source, callbackdata, cdCWnd)

end

## @deftypefn  {} {} btn_CDCstepresponse_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_CDCstepresponse control.
##
## @end deftypefn
function btn_CDCstepresponse_doIt(source, callbackdata, cdCWnd)


%
% Llama a graficar la respuesta al escal√≥n del sistema realimentado
%


% global variable
global _ltitoolBasePath;

%  Load data
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCdata'])
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCsim'])

% ----------------------------------
% Step Response
% ----------------------------------
figure
delay=0;
step_resp_CCD(Gp1,Gp2,Gv,Cint,Cext,Gm1,Gm2,GHint,Gt,delay,Gl1,Gl2, ...
              amplitud_sp,amplitud_l1,amplitud_l2,T_sp,T_l1,T_l2,TFinal, ...
              haChCons,haChCarga1,haChCarga2,1000);
hold off


% Informacion adicional para la ventana principal
% ------------------------------------------------------------------------
[estabilidad,yinf,Test]=additionalinfoFB(GHext.num{1,1},GHext.den{1,1},amplitud_sp,TFinal,1000);
set(cdCWnd.label_Estabilidad, "String", num2str(estabilidad));
set(cdCWnd.valor_final, "String", num2str(yinf));
set(cdCWnd.tiempo_estab_GH, "String", num2str(Test));

% 
refresh();

end

## @deftypefn  {} {} btn_CDCanalysis_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_CDCanalysis control.
##
## @end deftypefn
function btn_CDCanalysis_doIt(source, callbackdata, cdCWnd)


% Open cascade control system analysis window
cdCAnalysisWnd();

end

## @deftypefn  {} {} btn_runloadCDCdatawindow_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_runloadCDCdatawindow control.
##
## @end deftypefn
function btn_runloadCDCdatawindow_doIt(source, callbackdata, cdCWnd)


% Open window to load data
cdCLoadDataWnd();

end

## @deftypefn  {} {} btn_CDCsimparameters_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_CDCsimparameters control.
##
## @end deftypefn
function btn_CDCsimparameters_doIt(source, callbackdata, cdCWnd)


% Open window to load simaltion parameters
cdCSimParamWnd();

end

## @deftypefn  {} {} btn_CDCadditionalinfo_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_CDCadditionalinfo control.
##
## @end deftypefn
function btn_CDCadditionalinfo_doIt(source, callbackdata, cdCWnd)


%
% Additional information for CDC main window
% 

% global variable
global _ltitoolBasePath;

%  Load data
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCdata'])
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCsim'])


% Additional information for the main window
% ------------------------------------------------------------------------
% Additional information of stability
[estabilidad,yinf,Test]=additionalinfoFB(GHext.num{1,1},GHext.den{1,1},amplitud_sp,TFinal,1000);

% --------------------------------------------------------------------------------
% LAZO INTERNO
% --------------------------------------------------------------------------------
% Additional information about frequency response
nGHint=GHint.num{1,1}; dGHint=GHint.den{1,1};
[ceros_la, polos_la,KGHint]=xzpkdata(nGHint,dGHint);
nGHint=nGHint/KGHint;
GH_Kint = tf(nGHint,dGHint); %
Kastericint=KGHint;
GHint=tf(Kastericint*nGHint,dGHint);
[mGHint,pGHint,wint]=bode(GHint);
% fix the phase wrap arownd
phaudint=pGHint;
phwint=unwrap(phaudint*pi/180);
phaudint=phwint*180/pi;
% delayed plant phase,
%phad=phaud + ((-w.*delay)*180/pi)';
delay=0;
[Kastint,Kast_ultint,wultimoint,GMint,wcgint,PMint]=additionalinfofreq(GHint,Kastericint,mGHint,phaudint,delay,wint);


% --------------------------------------------------------------------------------
% LAZO EXTERNO
% --------------------------------------------------------------------------------
% Additional information about frequency response
nGHext=GHext.num{1,1}; dGHext=GHext.den{1,1};
[ceros_la, polos_la,KGHext]=xzpkdata(nGHext,dGHext);
nGHext=nGHext/KGHext;
GH_Kext = tf(nGHext,dGHext); %
Kastericext=KGHext;
GHext=tf(Kastericext*nGHext,dGHext);
[mGHext,pGHext,wext]=bode(GHext);
% fix the phase wrap arownd
phaudext=pGHext;
phwext=unwrap(phaudext*pi/180);
phaudext=phwext*180/pi;
% delayed plant phase,
%phad=phaud + ((-w.*delay)*180/pi)';
delay=0;
[Kastext,Kast_ultext,wultimoext,GMext,wcgext,PMext]=additionalinfofreq(GHext,Kastericext,mGHext,phaudext,delay,wext);



% ------------------------------------------------------------------------
% % Additional information for the main window
% ------------------------------------------------------------------------
% Dynamic response of cascade control system
set(cdCWnd.label_Estabilidad, "String", num2str(estabilidad));
set(cdCWnd.valor_final, "String", num2str(yinf));
set(cdCWnd.tiempo_estab_GH, "String", num2str(Test));
% Frequency response LAZO INTERNO
set(cdCWnd.Kasterisco_int, "String", num2str(Kastint))
set(cdCWnd.Kasterisco_ultimo_int, "String", num2str(Kast_ultint))
set(cdCWnd.wu_int, "String", num2str(wultimoint))
set(cdCWnd.gain_margin_int, "String", num2str(GMint))
set(cdCWnd.w_cg_int, "String", num2str(wcgint))
set(cdCWnd.phase_margin_int, "String", num2str(PMint))
% Frequency response LAZO EXTERNO
set(cdCWnd.Kasterisco_ext, "String", num2str(Kastext))
set(cdCWnd.Kasterisco_ultimo_ext, "String", num2str(Kast_ultext))
set(cdCWnd.wu_ext, "String", num2str(wultimoext))
set(cdCWnd.gain_margin_ext, "String", num2str(GMext))
set(cdCWnd.w_cg_ext, "String", num2str(wcgext))
set(cdCWnd.phase_margin_ext, "String", num2str(PMext))

end

## @deftypefn  {} {} btn_setdefaultCDC_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_setdefaultCDC control.
##
## @end deftypefn
function btn_setdefaultCDC_doIt(source, callbackdata, cdCWnd)


%
% Rewrite 2 files with predefined default data 
%
%

% global variable
global _ltitoolBasePath;

% Complex variable "s"
s=tf('s'); 
% plant, ME and FCE
tiempo_muerto=0.0;
Gp1=(s+1)/(s^2+s+1); Gp2=(1)/(2*s+1); Gl1=Gp1; Gl2=Gp1;
Gm1=tf(1,1); Gt=Gm1; Gm2=Gm1;
Gv=1/(0.1*s+1);
% controllers
Krint=5; Krext=1;
Cint=tf(Krint,1);
Cext=Krext*(1+1/(1*s));
% G(s)H(s)
GHint=Gp2*Gv*Cint*Gm2; Gastint1=minreal(Gp2*Gv*Cint/(1+GHint));
GHext=minreal(Gp1*Gastint1*Cext*Gm1);
% Simulation parameters
amplitud_sp=1; amplitud_l1=1;  amplitud_l2=1;
T_sp=1; T_l1=10;  T_l2=20; TFinal=30;

% Simulation window parameters
haChCons=1;
haChCarga1=1;
haChCarga2=1;

% Save data
save([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCdata'],'Gp1','Gp2','Gl1','Gl2','Gm1','Gm2','Gt','Gv', ...
                          'Cint','Cext','tiempo_muerto','Krint','Krext','GHint','GHext');

save([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCsim'],'T_sp','T_l1','T_l2','TFinal', ...
                          'amplitud_sp','amplitud_l1','amplitud_l2', ...
                          'haChCons','haChCarga1','haChCarga2');        

end

## @deftypefn  {} {} btn_clear_CDCsimfigure_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_clear_CDCsimfigure control.
##
## @end deftypefn
function btn_clear_CDCsimfigure_doIt(source, callbackdata, cdCWnd)

%
% Clear simulation window
%

% limpio la ventana con las simulaciones
cla(cdCWnd.simulationCCD_image)
% 
refresh();

end

## @deftypefn  {} {} btn_saveCDC_doIt (@var{source}, @var{callbackdata}, @var{cdCWnd})
##
## Define a callback for default action of btn_saveCDC control.
##
## @end deftypefn
function btn_saveCDC_doIt(source, callbackdata, cdCWnd)


%
% Save variables, transfer function, and so on
%

% global variable
global _ltitoolBasePath;

%  Load data
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCdata'])
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCsim'])


[fname, fpath, fltidx] = uiputfile ({'.txt','Archivos de texto';'.m', 'Scripts de octave';'.', 'Todos los archivos'}, 'Abrir archivo. Elija un nombre de archivo para abrir');
if(fname)


[tsim,ysim]=simulCCD(Gp1,Gp2,Gv,Cint,Cext,Gm1,Gm2,GHint,Gt,tiempo_muerto,Gl1,Gl2, ...
              amplitud_sp,amplitud_l1,amplitud_l2,T_sp,T_l1,T_l2,TFinal, ...
              haChCons,haChCarga1,haChCarga2,1000);

% ------------------------------------------------------------------------
% Informacion adicional
% ------------------------------------------------------------------------
[estabilidad,yinf,Test]=additionalinfoFB(GHext.num{1,1},GHext.den{1,1},amplitud_sp,TFinal,1000);

% --------------------------------------------------------------------------------
% LAZO INTERNO
% --------------------------------------------------------------------------------
% Additional information about frequency response
nGHint=GHint.num{1,1}; dGHint=GHint.den{1,1};
[zeros_GHint, poles_GHint,KGHint]=xzpkdata(nGHint,dGHint);
Kastericint=KGHint;
[mGHint,pGHint,wint]=bode(GHint);
% fix the phase wrap arownd
phaudint=pGHint;
phwint=unwrap(phaudint*pi/180);
phaudint=phwint*180/pi;
% delayed plant phase,
%phad=phaud + ((-w.*delay)*180/pi)';
%delay=0;
[Kastint,Kast_ultint,wultint,GMint,wcgint,PMint]=additionalinfofreq(GHint,Kastericint,mGHint,phaudint,tiempo_muerto,wint);


% --------------------------------------------------------------------------------
% LAZO EXTERNO
% --------------------------------------------------------------------------------
% Additional information about frequency response
nGHext=GHext.num{1,1}; dGHext=GHext.den{1,1};
[zeros_GHext, poles_GHext,KGHext]=xzpkdata(nGHext,dGHext);
Kastericext=KGHext;
[mGHext,pGHext,wext]=bode(GHext);
% fix the phase wrap arownd
phaudext=pGHext;
phwext=unwrap(phaudext*pi/180);
phaudext=phwext*180/pi;
% delayed plant phase,
%phad=phaud + ((-w.*delay)*180/pi)';
%delay=0;
[Kastext,Kast_ultext,wultext,GMext,wcgext,PMext]=additionalinfofreq(GHext,Kastericext,mGHext,phaudext,tiempo_muerto,wext);


% Zeros and poles of closed loop
Gcl=GHext/(1+GHext);
[zeros_cl, poles_cl,Kcl]=xzpkdata(Gcl.num{1,1},Gcl.den{1,1});


  % --------------------------
  % Save Results
  % --------------------------
  save([fpath fname], 'Gp1','Gp2','Gl1','Gl2','Gv','Gm1','Gm2','Gt','tiempo_muerto', ...
       'Krint', 'Krext','Cint', 'Cext', 'GHint', 'GHext', ...
       'Kastint','Kast_ultint','wultint','GMint','wcgint','PMint', ...
       'Kastext','Kast_ultext','wultext','GMext','wcgext','PMext', ...
       'zeros_GHint', 'poles_GHint','zeros_GHext', 'poles_GHext','zeros_cl', 'poles_cl', ...
       'estabilidad','yinf','Test', 'T_sp','T_l1','T_l2','TFinal','tsim','ysim', ...
       'amplitud_sp','amplitud_l1','amplitud_l2');
else
  disp('Cancelado');
endif;

end

 
## @deftypefn  {} {@var{ret} = } show_cdCWnd()
##
## Create windows controls over a figure, link controls with callbacks and return 
## a window struct representation.
##
## @end deftypefn
function ret = show_cdCWnd()
  _scrSize = get(0, "screensize");
  _xPos = (_scrSize(3) - 1218)/2;
  _yPos = 63;
   cdCWnd = figure ( ... 
	'Color', [0.949 0.949 0.949], ...
	'Position', [_xPos _yPos 1218 675], ...
	'Resize', 'on', ...
	'windowstyle', 'normal', ...
	'MenuBar', 'none');
  CDC_Image = axes( ...
	'Units', 'pixels', ... 
	'parent',cdCWnd, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [2 368 742 315]);
  btn_simulCDC = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [10 336 69 25], ... 
	'String', 'Simulate', ... 
	'TooltipString', '');
  btn_helpCDC = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [842 8 90 22], ... 
	'String', 'Help', ... 
	'TooltipString', '');
  btn_closeCCD = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [1099 8 90 22], ... 
	'String', 'Close', ... 
	'TooltipString', '');
  Label_10 = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [786 647 316 23], ... 
	'String', 'Analysis and Simulation of ', ... 
	'TooltipString', '');
  simulationCCD_image = axes( ...
	'Units', 'pixels', ... 
	'parent',cdCWnd, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [106 58 768 298]);
  estabilidad = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 378 86 17], ... 
	'String', 'Sistem:', ... 
	'TooltipString', '');
  Test = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 315 129 17], ... 
	'String', 'Settling Time. =  ', ... 
	'TooltipString', '');
  tiempo_estab_GH = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1109 313 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  y_inf = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 343 87 17], ... 
	'String', 'y(inf) =', ... 
	'TooltipString', '');
  valor_final = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1109 343 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_15 = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 8, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 296 103 14], ... 
	'String', '(Approximate)', ... 
	'TooltipString', '');
  btn_CDCstepresponse = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [875 334 25 22], ... 
	'String', '+', ... 
	'TooltipString', '');
  label_Estabilidad = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1073 373 126 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_19 = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [895 245 64 17], ... 
	'String', '[K*] = ', ... 
	'TooltipString', '');
  Kasterisco_int = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [967 243 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Kastultimo = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [895 208 61 17], ... 
	'String', '[K*u] = ', ... 
	'TooltipString', '');
  Kasterisco_ultimo_int = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [967 208 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_omega_u = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Symbol', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [895 173 69 27], ... 
	'String', 'w      =', ... 
	'TooltipString', '');
  wu_int = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [967 173 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_sub_u = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 9, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [910 168 30 17], ... 
	'String', '-180', ... 
	'TooltipString', '');
  Label_GM = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [895 138 58 17], ... 
	'String', 'GM = ', ... 
	'TooltipString', '');
  gain_margin_int = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [967 138 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_omega_180 = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Symbol', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [895 103 56 27], ... 
	'String', 'w  = ', ... 
	'TooltipString', '');
  Label_sub_cg = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 9, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [905 93 30 17], ... 
	'String', 'gc', ... 
	'TooltipString', '');
  w_cg_int = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [967 103 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_PM = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [895 63 56 17], ... 
	'String', 'PM  = ', ... 
	'TooltipString', '');
  phase_margin_int = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [967 63 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  btn_CDCanalysis = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [763 480 186 50], ... 
	'String', 'Analysis Tools', ... 
	'TooltipString', '');
  btn_runloadCDCdatawindow = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [763 537 186 46], ... 
	'String', 'Load Data', ... 
	'TooltipString', '');
  btn_CDCsimparameters = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [763 421 187 49], ... 
	'String', 'Simulation Parameters', ... 
	'TooltipString', '');
  btn_CDCadditionalinfo = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [990 403 183 22], ... 
	'String', 'Additional Information', ... 
	'TooltipString', '');
  btn_setdefaultCDC = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [985 561 215 22], ... 
	'String', 'Reload Default Values', ... 
	'TooltipString', '');
  btn_clear_CDCsimfigure = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [10 8 219 22], ... 
	'String', 'Clear Simulation Window', ... 
	'TooltipString', '');
  Label_14 = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [787 612 297 23], ... 
	'String', 'Cascade Control System', ... 
	'TooltipString', '');
  Label_15 = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [967 268 111 17], ... 
	'String', 'Internal Loop', ... 
	'TooltipString', '');
  Label_16 = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1095 268 118 17], ... 
	'String', 'External Loop', ... 
	'TooltipString', '');
  Kasterisco_ext = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1099 243 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Kasterisco_ultimo_ext = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1099 208 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  wu_ext = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1099 173 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  gain_margin_ext = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1099 138 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  w_cg_ext = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1099 103 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  phase_margin_ext = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1099 63 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  btn_saveCDC = uicontrol( ...
	'parent',cdCWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [970 8 90 22], ... 
	'String', 'Save', ... 
	'TooltipString', '');

  cdCWnd = struct( ...
      'figure', cdCWnd, ...
      'CDC_Image', CDC_Image, ...
      'btn_simulCDC', btn_simulCDC, ...
      'btn_helpCDC', btn_helpCDC, ...
      'btn_closeCCD', btn_closeCCD, ...
      'Label_10', Label_10, ...
      'simulationCCD_image', simulationCCD_image, ...
      'estabilidad', estabilidad, ...
      'Test', Test, ...
      'tiempo_estab_GH', tiempo_estab_GH, ...
      'y_inf', y_inf, ...
      'valor_final', valor_final, ...
      'Label_15', Label_15, ...
      'btn_CDCstepresponse', btn_CDCstepresponse, ...
      'label_Estabilidad', label_Estabilidad, ...
      'Label_19', Label_19, ...
      'Kasterisco_int', Kasterisco_int, ...
      'Kastultimo', Kastultimo, ...
      'Kasterisco_ultimo_int', Kasterisco_ultimo_int, ...
      'Label_omega_u', Label_omega_u, ...
      'wu_int', wu_int, ...
      'Label_sub_u', Label_sub_u, ...
      'Label_GM', Label_GM, ...
      'gain_margin_int', gain_margin_int, ...
      'Label_omega_180', Label_omega_180, ...
      'Label_sub_cg', Label_sub_cg, ...
      'w_cg_int', w_cg_int, ...
      'Label_PM', Label_PM, ...
      'phase_margin_int', phase_margin_int, ...
      'btn_CDCanalysis', btn_CDCanalysis, ...
      'btn_runloadCDCdatawindow', btn_runloadCDCdatawindow, ...
      'btn_CDCsimparameters', btn_CDCsimparameters, ...
      'btn_CDCadditionalinfo', btn_CDCadditionalinfo, ...
      'btn_setdefaultCDC', btn_setdefaultCDC, ...
      'btn_clear_CDCsimfigure', btn_clear_CDCsimfigure, ...
      'Label_14', Label_14, ...
      'Label_15', Label_15, ...
      'Label_16', Label_16, ...
      'Kasterisco_ext', Kasterisco_ext, ...
      'Kasterisco_ultimo_ext', Kasterisco_ultimo_ext, ...
      'wu_ext', wu_ext, ...
      'gain_margin_ext', gain_margin_ext, ...
      'w_cg_ext', w_cg_ext, ...
      'phase_margin_ext', phase_margin_ext, ...
      'btn_saveCDC', btn_saveCDC);


  set (btn_simulCDC, 'callback', {@btn_simulCDC_doIt, cdCWnd});
  set (btn_helpCDC, 'callback', {@btn_helpCDC_doIt, cdCWnd});
  set (btn_closeCCD, 'callback', {@btn_closeCCD_doIt, cdCWnd});
  set (tiempo_estab_GH, 'callback', {@tiempo_estab_GH_doIt, cdCWnd});
  set (btn_CDCstepresponse, 'callback', {@btn_CDCstepresponse_doIt, cdCWnd});
  set (btn_CDCanalysis, 'callback', {@btn_CDCanalysis_doIt, cdCWnd});
  set (btn_runloadCDCdatawindow, 'callback', {@btn_runloadCDCdatawindow_doIt, cdCWnd});
  set (btn_CDCsimparameters, 'callback', {@btn_CDCsimparameters_doIt, cdCWnd});
  set (btn_CDCadditionalinfo, 'callback', {@btn_CDCadditionalinfo_doIt, cdCWnd});
  set (btn_setdefaultCDC, 'callback', {@btn_setdefaultCDC_doIt, cdCWnd});
  set (btn_clear_CDCsimfigure, 'callback', {@btn_clear_CDCsimfigure_doIt, cdCWnd});
  set (btn_saveCDC, 'callback', {@btn_saveCDC_doIt, cdCWnd});
  dlg = struct(cdCWnd);


% Load packages
%pkg load control;
%pkg load linear-algebra;
%pkg load odepkg;
%pkg load optim;
%pkg load signal;
%pkg load struct;

% global variable
global _ltitoolBasePath;

% Presentation image
axes(cdCWnd.CDC_Image);
imshow([_ltitoolBasePath filesep() 'img' filesep() 'CDControl.png']);
refresh();


%------------------------------------------------------------------------
% Load data
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCdata'])
load([_ltitoolBasePath filesep() 'data' filesep() 'loadCDCsim'])
%------------------------------------------------------------------------

% Limpio el command Window de Octave
clc

%refresh();



  ret = cdCWnd;
end

