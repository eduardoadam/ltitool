%
% Set the graphics toolkit and force read this file as script file (not a function file).
%
graphics_toolkit qt;
%


%
%
% Begin callbacks definitions 
%

function btn_ZPmap_doIt(source, callbackdata, OLwindow)

%
% Zeros and poles map plot
%

% global variable
global _basePath;

% s-variable is defined
s = tf('s');

% ---------------------------------------------------------------------------------------------------------------------------------------------
% Open Loop transfer function, GLA(s)
numGLA = get(dlg.numGLA, 'string');
denGLA = get(dlg.denGLA, 'string');
sysStrGLA = strcat('(',numGLA,')', '/','(', denGLA,')');
GLA = tf(eval(sysStrGLA));	% Funcion de transferencia de lazo abierto
% ---------------------------------------------------------------------------------------------------------------------------------------------
k = str2num(get(dlg.amplitud_k, 'string'));  % k: amplitud del escalon
tFinal = str2num(get(dlg.tFinal, 'string')); % Tf: tiempo de simulacion
% ---------------------------------------------------------------------------------------------------------------------------------------------

% ----------------------------------
% Zeros and poles map
% ----------------------------------
title_string='Zeros and Poles Map of G(s)';
legend_ceros_string='Zeros of G(s)';
legend_polos_string='Poles of G(s)';

% Plot
% ----------------------------------
axes(dlg.Image_2);
xpzmap(title_string,legend_ceros_string,legend_polos_string,GLA.num{1,1},GLA.den{1,1});
figuraGLA=1;

% Stability analysis
% --------------------------------
[estabilidad,yinf,Test]=additionalinfo(GLA.num{1,1},GLA.den{1,1},tFinal,1000);
set(dlg.label_EstabilidadGLA, "String", num2str(estabilidad));
set(dlg.valor_final, "String", num2str(yinf));
set(dlg.tiempo_estab, "String", num2str(Test));

% Save data
save([_basePath filesep() 'data' filesep() 'loadOLdata'],'figuraGLA','GLA','k','tFinal')

refresh();

end

function btn_OLstep_doIt(source, callbackdata, OLwindow)

%
% Step response is ploted
%

% global variable
global _basePath;

% s-variable is defined
s=tf('s');

% ---------------------------------------------------------------------------------------------------------------------------------------------
% Open Loop transfer function, GLA(s)
numGLA = get(dlg.numGLA, 'string');
denGLA = get(dlg.denGLA, 'string');
sysStrGLA = strcat('(',numGLA,')', '/','(', denGLA,')');
GLA = tf(eval(sysStrGLA));	% open loop transfer function GLA(s)
% ---------------------------------------------------------------------------------------------------------------------------------------------
k = str2num(get(dlg.amplitud_k, 'string'));  % k: step amplitud
tFinal = str2num(get(dlg.tFinal, 'string')); % Tf: imulation time
% ---------------------------------------------------------------------------------------------------------------------------------------------

% Plot
% ----------------------------------
axes(dlg.Image_2);
OLstepresponse(GLA.num{1,1},GLA.den{1,1},k,0.0,tFinal,1000);
figuraGLA=2;

% Stability analysis
% --------------------------------
[estabilidad,yinf,Test]=additionalinfo(GLA.num{1,1},GLA.den{1,1},tFinal,1000);
set(dlg.label_EstabilidadGLA, "String", num2str(estabilidad));
set(dlg.valor_final, "String", num2str(yinf));
set(dlg.tiempo_estab, "String", num2str(Test));


% Save data
% --------------------------------
save([_basePath filesep() 'data' filesep() 'loadOLdata'],'figuraGLA','GLA','k','tFinal')

%
refresh();

end

function btn_OLimp_doIt(source, callbackdata, OLwindow)

%
% Impulse response is ploted
%

% global variable
global _basePath;

% s-variable is defined
s=tf('s');

% Numerator and denominator of open loop transfer function GLA(s)
numGLA = get(OLwindow.numGLA, 'string');
denGLA = get(OLwindow.denGLA, 'string');
sysStrGLA = strcat('(',numGLA,')', '/','(', denGLA,')');
GLA = tf(eval(sysStrGLA));	% open loop transfer function GLA(s)
% ------------------------------------------------
k = str2num(get(dlg.amplitud_k, 'string'));  % k: step amplitud
tFinal = str2num(get(dlg.tFinal, 'string')); % Tf: simulation time

% Plot impulse response
% ----------------------------------
axes(dlg.Image_2);
OLimpulseresponse(GLA.num{1,1},GLA.den{1,1},0.0,tFinal,1000);
hold off
figuraGLA=3;


% Stability analisis 
% --------------------------------
sGLA=minreal(s*GLA); % multiply by s to calculate the impulse response
[estabilidad,yinf,Test]=additionalinfo(sGLA.num{1,1},sGLA.den{1,1},tFinal,1000);
set(dlg.label_EstabilidadGLA, "String", num2str(estabilidad));
set(dlg.valor_final, "String", num2str(yinf));
set(dlg.tiempo_estab, "String", num2str(Test));


% Save data
% --------------------------------
save([_basePath filesep() 'data' filesep() 'loadOLdata'],'figuraGLA','GLA','k','tFinal')

refresh();

end

function btn_OLclose_doIt(source, callbackdata, OLwindow)


  % Cierro la ventana
  close(OLwindow.OLwindow);

end

function btn_OLfig_doIt(source, callbackdata, OLwindow)


% global variable
global _basePath;

% Complex variable "s"
s=tf('s');

% Load data
load([_basePath filesep() 'data' filesep() 'loadOLdata'])

if figuraGLA==1,
  figure
  title_string='Mapa de Polos y Ceros G(s) de Lazo Abierto';
  legend_ceros_string='Ceros de Lazo Abierto';
  legend_polos_string='Polos de Lazo Abierto';
  xpzmap(title_string,legend_ceros_string,legend_polos_string,GLA.num{1,1},GLA.den{1,1});
  axisx=xlabel('Parte Real'); axisy=ylabel('Parte Imaginaria');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGLA=1;
  % Save data
  save([_basePath filesep() 'data' filesep() 'loadOLdata'],'figuraGLA','GLA','k','tFinal')
endif
if figuraGLA==2,
  figure
  OLstepresponse(GLA.num{1,1},GLA.den{1,1},k,0.0,tFinal,1000);
  axisx=xlabel('Tiempo'); axisy=ylabel('Salida');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGLA=2;
  % Save data
  save([_basePath filesep() 'data' filesep() 'loadOLdata'],'figuraGLA','GLA','k','tFinal')
endif
if figuraGLA==3,
  figure
  OLimpulseresponse(GLA.num{1,1},GLA.den{1,1},0.0,tFinal,1000);
  axisx=xlabel('Tiempo'); axisy=ylabel('Salida');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGLA=3;
  % Save data
  save([_basePath filesep() 'data' filesep() 'loadOLdata'],'figuraGLA','GLA','k','tFinal')
end

end

function btn_OLsave_doIt(source, callbackdata, OLwindow)


% Save data of:
% 	Transfer function,
% 	Step response,
% 	Impulse response,
% 	Step amplitud
% 	Simulation time
% 	Final value of step response 
% 	Tiempo de establecimiento


[fname, fpath, fltidx] = uiputfile ({'.txt','Archivos de texto';'.m', 'Scripts de octave';'.', 'Todos los archivos'}, 'Abrir archivo. Elija un nombre de archivo para abrir');
if(fname)
  % Complex variable "s"
  s = tf('s');

  % ---------------------------------------------------------------------------------------------------------------------------------------------
  % Open loop transfer function, Gol(s)
  numGLA = get(dlg.numGLA, 'string');
  denGLA = get(dlg.denGLA, 'string');
  sysStrGLA = strcat('(',numGLA,')', '/','(', denGLA,')');
  GLA = tf(eval(sysStrGLA));
  % ---------------------------------------------------------------------------------------------------------------------------------------------
  k = str2num(get(dlg.amplitud_k, 'string'));  % k: step amplitud
  tFinal = str2num(get(dlg.tFinal, 'string')); % Tf: simulation time
  % ---------------------------------------------------------------------------------------------------------------------------------------------

  % Zeros-Poles of Gol(s)
  Gs=minreal(GLA);
  polosGs=roots(Gs.den{1,1});
  zerosGs=roots(Gs.num{1,1});

  % Simulations
  % --------------------
  % Step response
  step_amplitud=k;
  DT=tFinal/1000;			%Time interval
  [step_ysim,step_tsim]=step(k*Gs,tFinal,DT);
  % Impulse response
  [imp_ysim,imp_tsim]=impulse(Gs,tFinal,DT);

  % Stability analysis
  % --------------------------------
  [estabilidad,yinf,Test]=additionalinfo(GLA.num{1,1},GLA.den{1,1},tFinal,1000);

  % Save results
  % --------------------------
  save([fpath fname], 'Gs', 'polosGs', 'zerosGs', ...
       'estabilidad', 'yinf', 'Test', 'step_amplitud', 'step_tsim', 'step_ysim', 'imp_ysim', 'imp_tsim');

else
  disp('Cancelado');
endif;

end

function btn_OLsetdefault_doIt(source, callbackdata, OLwindow)


%
% Default data of GLA is saved and loaded on the main window
%
%

% global variable
global _basePath;

% Complex variable "s"
s=tf('s'); 

% Open loop transfer function
% --------------------------
GLA=(s+1)/(s^2+0.5*s+1);

% figure flag
figuraGLA=1;

% Simulation
k=1;		% step amplitud
tFinal=20;	% simulation time

% Save data defined as default
% ---------------------------------------------------
save([_basePath filesep() 'data' filesep() 'loadOLdata'],'figuraGLA','GLA','k','tFinal')

% ------------------------------------------------------------------------
% Information is reloaded on the main window
% ------------------------------------------------------------------------
set(dlg.numGLA,'string',polyout(GLA.num{1,1})); 
set(dlg.denGLA,'string',polyout(GLA.den{1,1}));
set(dlg.amplitud_k,'string',num2str(k));
set(dlg.tFinal,'string',num2str(tFinal));

end

 
%
% Dialog creation windows function 
%
function ret = show_OLwindow()
  _scrSize = get(0, "screensize");
  _xPos = (_scrSize(3) - 1108)/2;
  _yPos = 146;
   OLwindow = figure ( ... 
	'Color', [0.949 0.949 0.949], ...
	'Position', [_xPos _yPos 1108 592], ...
	'Resize', 'on', ...
	'windowstyle', 'normal', ...
	'MenuBar', 'none');
  Image_GOL = axes( ...
	'Units', 'pixels', ... 
	'parent',OLwindow, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [14 325 529 216]);
  numGLA = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [578 454 195 23], ... 
	'String', '', ... 
	'TooltipString', '');
  denGLA = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [578 396 192 21], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_2 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [530 430 253 17], ... 
	'String', 'G(s) = -----------------------------------------------', ... 
	'TooltipString', '');
  Label_3 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [798 457 169 17], ... 
	'String', 'bm*s^m+......+b1*s^1+b0', ... 
	'TooltipString', '');
  Label_4 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [798 403 146 17], ... 
	'String', 'an*s^n+.....+a1*s^1+1', ... 
	'TooltipString', '');
  btn_ZPmap = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [25 270 173 22], ... 
	'String', 'Poles and Zeros Map', ... 
	'TooltipString', '');
  Label_5 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 13, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [535 507 239 20], ... 
	'String', 'Open Loop Transfer Function:', ... 
	'TooltipString', '');
  Label_6 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 13, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [20 299 188 20], ... 
	'String', 'Information about G(s):', ... 
	'TooltipString', '');
  Label_7 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 13, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [20 232 91 20], ... 
	'String', 'Simulation:', ... 
	'TooltipString', '');
  Label_8 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 13, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [20 132 189 20], ... 
	'String', 'Simulation Parameters:', ... 
	'TooltipString', '');
  btn_OLstep = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [25 198 173 25], ... 
	'String', 'Step Response', ... 
	'TooltipString', '');
  btn_OLimp = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [25 163 173 24], ... 
	'String', 'Impulse Response', ... 
	'TooltipString', '');
  amplitud_k = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [180 95 52 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_9 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [25 97 97 17], ... 
	'String', 'Step Amplitud', ... 
	'TooltipString', '');
  Label_10 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [25 66 113 17], ... 
	'String', 'Simulation Time:', ... 
	'TooltipString', '');
  tFinal = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [180 64 50 22], ... 
	'String', '', ... 
	'TooltipString', '');
  btn_OLhelp = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [22 5 90 22], ... 
	'String', 'Help', ... 
	'TooltipString', '');
  btn_OLclose = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [997 5 90 22], ... 
	'String', 'Close', ... 
	'TooltipString', '');
  Label_10 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [19 559 444 23], ... 
	'String', 'Analysis and Simulation of Open Loop Systems', ... 
	'TooltipString', '');
  Image_2 = axes( ...
	'Units', 'pixels', ... 
	'parent',OLwindow, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [311 64 534 231]);
  Info = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [885 280 168 17], ... 
	'String', 'Additional Information:', ... 
	'TooltipString', '');
  sistema = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [875 237 53 17], ... 
	'String', 'System:', ... 
	'TooltipString', '');
  Test = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [875 155 110 17], ... 
	'String', 'Settling Time. = ', ... 
	'TooltipString', '');
  tiempo_estab = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1002 155 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  y_inf = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [875 195 48 17], ... 
	'String', 'y(inf) =', ... 
	'TooltipString', '');
  valor_final = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [955 195 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_15 = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 8, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [875 133 72 14], ... 
	'String', '(Approximate)', ... 
	'TooltipString', '');
  label_Estabilidad = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [955 240 0 17], ... 
	'String', '', ... 
	'TooltipString', '');
  btn_OLfig = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [845 275 25 22], ... 
	'String', '+', ... 
	'TooltipString', '');
  label_EstabilidadGLA = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [955 235 147 22], ... 
	'String', '', ... 
	'TooltipString', '');
  btn_OLsave = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [890 5 90 22], ... 
	'String', 'Save', ... 
	'TooltipString', '');
  btn_OLsetdefault = uicontrol( ...
	'parent',OLwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [885 505 212 22], ... 
	'String', 'Load Set Default Values', ... 
	'TooltipString', '');

  OLwindow = struct( ...
      'figure', OLwindow, ...
      'Image_GOL', Image_GOL, ...
      'numGLA', numGLA, ...
      'denGLA', denGLA, ...
      'Label_2', Label_2, ...
      'Label_3', Label_3, ...
      'Label_4', Label_4, ...
      'btn_ZPmap', btn_ZPmap, ...
      'Label_5', Label_5, ...
      'Label_6', Label_6, ...
      'Label_7', Label_7, ...
      'Label_8', Label_8, ...
      'btn_OLstep', btn_OLstep, ...
      'btn_OLimp', btn_OLimp, ...
      'amplitud_k', amplitud_k, ...
      'Label_9', Label_9, ...
      'Label_10', Label_10, ...
      'tFinal', tFinal, ...
      'btn_OLhelp', btn_OLhelp, ...
      'btn_OLclose', btn_OLclose, ...
      'Label_10', Label_10, ...
      'Image_2', Image_2, ...
      'Info', Info, ...
      'sistema', sistema, ...
      'Test', Test, ...
      'tiempo_estab', tiempo_estab, ...
      'y_inf', y_inf, ...
      'valor_final', valor_final, ...
      'Label_15', Label_15, ...
      'label_Estabilidad', label_Estabilidad, ...
      'btn_OLfig', btn_OLfig, ...
      'label_EstabilidadGLA', label_EstabilidadGLA, ...
      'btn_OLsave', btn_OLsave, ...
      'btn_OLsetdefault', btn_OLsetdefault);


  set (btn_ZPmap, 'callback', {@btn_ZPmap_doIt, OLwindow});
  set (btn_OLstep, 'callback', {@btn_OLstep_doIt, OLwindow});
  set (btn_OLimp, 'callback', {@btn_OLimp_doIt, OLwindow});
  set (btn_OLclose, 'callback', {@btn_OLclose_doIt, OLwindow});
  set (btn_OLfig, 'callback', {@btn_OLfig_doIt, OLwindow});
  set (btn_OLsave, 'callback', {@btn_OLsave_doIt, OLwindow});
  set (btn_OLsetdefault, 'callback', {@btn_OLsetdefault_doIt, OLwindow});
  dlg = struct(OLwindow);


% global variable
global _basePath;

% Open loop image
axes(OLwindow.Image_GOL);
imshow([_basePath filesep() 'img' filesep() 'fig_OL.png']);
refresh();

%------------------------------------------------------------------------------------------------
%  Load data defined by default
load([_basePath filesep() 'data' filesep() 'loadOLdata'])
%------------------------------------------------------------------------------------------------

% Clear the command Window
clc

%------------------------------------------------------------------------------------------------
% Show data inside teh window
set(OLwindow.numGLA,'string',polyout(GLA.num{1,1})); 
set(OLwindow.denGLA,'string',polyout(GLA.den{1,1}));
set(OLwindow.amplitud_k,'string',num2str(k));
set(OLwindow.tFinal,'string',num2str(tFinal));
%------------------------------------------------------------------------------------------------





  ret = OLwindow;
end

