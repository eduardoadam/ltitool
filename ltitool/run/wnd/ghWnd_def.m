## -*- texinfo -*-
## @deftypefn  {} {} dummy()
##
## This is a dummy function documentation. This file have a lot functions
## and each one have a little documentation. This text is to avoid a warning when
## install this file as part of package.
## @end deftypefn
##
## Set the graphics toolkit and force read this file as script file (not a function file).
##
graphics_toolkit qt;
##


##
##
## Begin callbacks definitions 
##

## @deftypefn  {} {} btn_GHmap_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_GHmap control.
##
## @end deftypefn
function btn_GHmap_doIt(source, callbackdata, ghWnd)

%
% Plot zeros-poles map of G(s)H(s)
%

% global variable
global _ltitoolBasePath;

% Clear figure
cla(ghWnd.Image_2, "reset")

s = tf('s');

% Read data from main window
% ------------------------------------------------
% Data from main window
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: step amplitud
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: simulation time
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain

% Built GH transfer function
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');
GH_Kr = tf(eval(sysStrGH));	% transfer function of G(s)H(s)/Kr
GH=Kr*GH_Kr;

% ----------------------------------
% Zeros-Poles map of G(s)H(s)
% ----------------------------------
title_string='Zeros and Poles Map of G(s)H(s)';
legend_ceros_string='Zeros of G(s)H(s)';
legend_polos_string='Poles of G(s)H(s)';

% Plot zeros-poles map
% ----------------------------------
axes(ghWnd.Image_2);
xpzmap(title_string,legend_ceros_string,legend_polos_string,GH.num{1,1},GH.den{1,1});
%xpzmap(title_string,legend_ceros_string,legend_polos_string,GH.num{1,1},GH.den{1,1});
figuraGH=1;

% Save data
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')


refresh();

end

## @deftypefn  {} {} btn_GHstep_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_GHstep control.
##
## @end deftypefn
function btn_GHstep_doIt(source, callbackdata, ghWnd)

%
% Closed loop system step response
%

% global variable
global _ltitoolBasePath;

% clear figure
cla(ghWnd.Image_2, "reset")

% Complex variable "s"
s = tf('s');

% Read data from main window
% ------------------------------------------------
% Data from main window, G(s)H(s) and Kr
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: step amplitud
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: simulation time
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain

% Built GH transfer function
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');
GH_Kr = tf(eval(sysStrGH));	% Transfer Funtion G(s)H(s) /Kr
GH=minreal(Kr*GH_Kr);			% Transfer Funtion G(s)H(s) 

% ----------------------------------
% Respuesta al Escalon
% ----------------------------------
axes(ghWnd.Image_2);
GHstepresponse(GH.num{1,1},GH.den{1,1},AmplitudSP,tFinal,1000);
hold off
figuraGH=6;


% Additional information for main window
% ------------------------------------------------------------------------
[estabilidad,yinf,Test]=additionalinfoFB(GH.num{1,1},GH.den{1,1},AmplitudSP,tFinal,1000);
set(ghWnd.label_Estabilidad, "String", num2str(estabilidad));
set(ghWnd.valor_final, "String", num2str(yinf));
set(ghWnd.tiempo_estab_GH, "String", num2str(Test));

% graba datos
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')

refresh();

end

## @deftypefn  {} {} btn_GHimp_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_GHimp control.
##
## @end deftypefn
function btn_GHimp_doIt(source, callbackdata, ghWnd)

%
% Llama a graficar un escal√≥n
%

% global variable
global _ltitoolBasePath;

% limpio la figura
cla(ghWnd.Image_2, "reset")

s = tf('s');

% Funcion de transferencia de LA
% ------------------------------------------------
% Num : string del numerador que toma de la ventana principal
% Den: string del denominador que toma de la ventana princial
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: steo amplitud
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: simulation time
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain

% Built GH transfer function
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');
GH_Kr = tf(eval(sysStrGH));	% Transfer Funtion G(s)H(s) 
GH=minreal(Kr*GH_Kr);			% Transfer Funtion G(s)H(s) 


% ----------------------------------
% Impulse Response
% ----------------------------------
axes(ghWnd.Image_2);
GHimpulseresponse(GH.num{1,1},GH.den{1,1},tFinal,1000);
hold off
figuraGH=7;

% Additional information for main window
% ------------------------------------------------------------------------
Gcl=minreal(s*GH/(1+GH)); % multiply by s to calculate the impulse response using Gcl(s)
[estabilidad,yinf,Test]=additionalinfo(Gcl.num{1,1},Gcl.den{1,1},AmplitudSP,tFinal,1000);
set(ghWnd.label_Estabilidad, "String", num2str(estabilidad));
set(ghWnd.tiempo_estab_GH, "String", num2str(Test));
set(ghWnd.valor_final, "String", num2str(yinf));

% Save data
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')

refresh();

end

## @deftypefn  {} {} ayudaLA_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of ayudaLA control.
##
## @end deftypefn
function ayudaLA_doIt(source, callbackdata, ghWnd)


%
% Run presentation to help  as html file.
%

% global variable
global _ltitoolBasePath;

% Load html file
url = ["file:" _ltitoolBasePath filesep() "ltitool_manual" filesep() "node13.html"];

  if(isunix())
    system(["xdg-open " url]);
  elseif (ispc())
    system(["start " url]);
  else
    disp(["I don't know how to open " url " in your os. Sorry!"]);
  endif;

end

## @deftypefn  {} {} btn_closeGH_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_closeGH control.
##
## @end deftypefn
function btn_closeGH_doIt(source, callbackdata, ghWnd)


  % Cierro la ventana
  close(ghWnd.figure);

end

## @deftypefn  {} {} btn_GHfigs_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_GHfigs control.
##
## @end deftypefn
function btn_GHfigs_doIt(source, callbackdata, ghWnd)

% global variable
global _ltitoolBasePath;

% Complex variable s
s=tf('s');

% load data from the last figure
load([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'])

if figuraGH==1, % Zeros and poles map of G(s)H(s)
  figure
  title_string='Poles and Zeros Map of G(s)H(s)';
  legend_ceros_string='Zeros of G(s)H(s)';
  legend_polos_string='Poles of G(s)H(s)';
  xpzmap(title_string,legend_ceros_string,legend_polos_string,GH.num{1,1},GH.den{1,1});
  axisx=xlabel('Real Part'); axisy=ylabel('Imaginary Part');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGH=1;
  % Save data
  save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')
endif

if figuraGH==2, % Zeros and poles map of Glc(s)
  figure
  Glc = minreal(GH/(1+GH));  % Closed loop transfer funtion
  title_string='Poles and Zeros Map of Closed Loop';
  legend_ceros_string='Closed Loop Zeros';
  legend_polos_string='Closed Loop Poles';
  xpzmap(title_string,legend_ceros_string,legend_polos_string,Glc.num{1,1},Glc.den{1,1});
  axisx=xlabel('Real Part'); axisy=ylabel('Imaginary Part');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGH=2;
  % Save data
  save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')
endif

if figuraGH==3, % Root locus diagram
  figure
  [Kast,Kast_ult,wultimo,GM,w180,PM]=GHrlocusplot(GH.num{1,1},GH.den{1,1},Kr,1000);
  axisx=xlabel('Real G(s)H(s)'); axisy=ylabel('Imag. G(s)H(s)');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGH=3;
  % Save data
  save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')
endif

if figuraGH==4, % Bode Diagram
  figure
  delay=0;
  [Kast,Kast_ult,wultimo,GM,wcg,PM]=GHbodeplot(GH.num{1,1},GH.den{1,1},delay,Kr);
  % rewrite data
  figuraGH=4;  
  % Save data
  save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')
endif

if figuraGH==5, % Nyquist Diagram
  figure
  delay=0;
  [Kast,Kast_ult,wultimo,GM,wcg,PM]=GHnyquistplot(GH.num{1,1},GH.den{1,1},delay,Kr);
  % rewrite data
  figuraGH=5;
  % Save data
  save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')
endif

if figuraGH==6, % Step response
  % Grafico
  figure
  GHstepresponse(GH.num{1,1},GH.den{1,1},AmplitudSP,tFinal,1000)
  axisx=xlabel('Time'); axisy=ylabel('Ouput');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGH=6;
  % Save data
  save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')
endif

if figuraGH==7, % Impulse response
  figure
  GHimpulseresponse(GH.num{1,1},GH.den{1,1},tFinal,1000);
  axisx=xlabel('Time'); axisy=ylabel('Ouput');
  set(axisx,'fontsize',14);  
  set(axisy,'fontsize',14);  
  % rewrite data
  figuraGH=7;
  % Save data
  save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')
endif

end

## @deftypefn  {} {} btn_RL_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_RL control.
##
## @end deftypefn
function btn_RL_doIt(source, callbackdata, ghWnd)

%
% Plot Root Locus
%

% global variable
global _ltitoolBasePath;

% Clear figure
cla(ghWnd.Image_2, "reset")

% Complex variable "s"
s = tf('s');

% Read data from main window
% -----------------------------------------------------
% Data from main window, G(s)H(s) and Kr
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');

% Built GH transfer function
GH_Kr = tf(eval(sysStrGH));	% Transfer Funtion G(s)H(s) /Kr
GH=Kr*GH_Kr;

% Simulation values
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: amplitud del escalon
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: tiempo de simulacion

% ----------------------------------
% Root locus plot
% ----------------------------------
axes(ghWnd.Image_2);
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHrlocusplot(GH.num{1,1},GH.den{1,1},Kr,1000);
hold off
figuraGH=3;


% Additional information for main window
% ------------------------------------------------------------------------
set(ghWnd.Kasterisco, "String", num2str(Kast))
set(ghWnd.Kasterisco_ultimo, "String", num2str(Kast_ult))
set(ghWnd.wu, "String", num2str(wultimo))
set(ghWnd.gain_margin, "String", num2str(GM))
set(ghWnd.w_cg, "String", num2str(wcg))
set(ghWnd.phase_margin, "String", num2str(PM))

% Save data
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')

end

## @deftypefn  {} {} btn_Bode_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_Bode control.
##
## @end deftypefn
function btn_Bode_doIt(source, callbackdata, ghWnd)


%
% Bode Plot
%

% global variable
global _ltitoolBasePath;

% Complex variable "s"
s = tf('s');

% Read data from main window
% -----------------------------------------------------
% Data from main window, G(s)H(s) and Kr
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');

% Built GH transfer function
GH_Kr = tf(eval(sysStrGH));		% Transfer Funtion G(s)H(s) /Kr
GH=Kr*GH_Kr;				% Transfer Funtion G(s)H(s) 

% Simulation values
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: amplitud del escalon
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: tiempo de simulacion

% ----------------------------------
% Bode diagram
% ----------------------------------
figure
delay=0;
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHbodeplot(GH.num{1,1},GH.den{1,1},delay,Kr);
hold off
figuraGH=4;

% ------------------------------------------------------------------------
% Additional information for main window
% ------------------------------------------------------------------------
set(ghWnd.Kasterisco, "String", num2str(Kast));
set(ghWnd.Kasterisco_ultimo, "String", num2str(Kast_ult));
set(ghWnd.wu, "String", num2str(wultimo));
set(ghWnd.gain_margin, "String", num2str(GM));
set(ghWnd.w_cg, "String", num2str(wcg));
set(ghWnd.phase_margin, "String", num2str(PM));

% Save data
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')

end

## @deftypefn  {} {} btn_Nyquist_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_Nyquist control.
##
## @end deftypefn
function btn_Nyquist_doIt(source, callbackdata, ghWnd)


%
% Plot Nyquist
%

% global variable
global _ltitoolBasePath;

% clear figure
cla(ghWnd.Image_2, "reset")

% Complex variable "s"
s = tf('s');

% Read data from main window
% -----------------------------------------------------
% Data from main window, G(s)H(s) and Kr
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');

% Built GH transfer function
GH_Kr = tf(eval(sysStrGH));	% Transfer Funtion G(s)H(s) /Kr
GH=Kr*GH_Kr;			% Transfer Funtion G(s)H(s)

% Simulation values
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: step amplitud
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: simulation time

% ----------------------------------
% Niquist diagram
% ----------------------------------
axes(ghWnd.Image_2);
delay=0;
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHnyquistplot(GH.num{1,1},GH.den{1,1},delay,Kr);
hold off
figuraGH=5;

% ------------------------------------------------------------------------
% Additional information for main window
% ------------------------------------------------------------------------
set(ghWnd.Kasterisco, "String", num2str(Kast));
set(ghWnd.Kasterisco_ultimo, "String", num2str(Kast_ult));
set(ghWnd.wu, "String", num2str(wultimo));
set(ghWnd.gain_margin, "String", num2str(GM));
set(ghWnd.w_cg, "String", num2str(wcg));
set(ghWnd.phase_margin, "String", num2str(PM));

% Save data
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')

end

## @deftypefn  {} {} btn_Glcmap_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_Glcmap control.
##
## @end deftypefn
function btn_Glcmap_doIt(source, callbackdata, ghWnd)

%
% Plot zeros-poles map of closed loop function
%

% global variable
global _ltitoolBasePath;

% Clear figure
cla(ghWnd.Image_2, "reset")

s = tf('s');

% Read data from main window
% ------------------------------------------------
% Data from main window
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: step amplitud
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: simulation time
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain

% Built GH transfer function
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');
GH_Kr = tf(eval(sysStrGH));	% Funcion de transferencia de G(s)H(s)/Kr
GH=Kr*GH_Kr;

% Built closed loop transfer function
Glc = minreal(GH/(1+GH));

% -------------------------------------------------------------------------
% Zeros-Poles map of closed loop system
% -------------------------------------------------------------------------
title_string='Zeros and Poles Map of Closed Loop System';
legend_ceros_string='Zeros of Gcl(s)';
legend_polos_string='Poles of Gcl(s)';

% Plot zeros-poles map
% ----------------------------------
axes(ghWnd.Image_2);
xpzmap(title_string,legend_ceros_string,legend_polos_string,Glc.num{1,1},Glc.den{1,1});
figuraGH=2;

% Save data
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')

refresh();

end

## @deftypefn  {} {} btn_infoadicional_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_infoadicional control.
##
## @end deftypefn
function btn_infoadicional_doIt(source, callbackdata, ghWnd)


%
% Present adicional information from main window values
%

% global variable
global _ltitoolBasePath;

% complex variable "s"
s = tf('s');

% Read data from main window
% -----------------------------------------------------
% Data from main window, G(s)H(s) and Kr
Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain
numGH = get(ghWnd.numGH, 'string');
denGH = get(ghWnd.denGH, 'string');
sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');

% Built GH transfer function
GH_Kr = tf(eval(sysStrGH));	% Transfer Funtion G(s)H(s) /Kr
GH=Kr*GH_Kr;			% Transfer Funtion G(s)H(s) 

% Simulation values
AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: step amplitud
tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: simulation time


% Additional information for main window
% ------------------------------------------------------------------------
% Additional information of  dinamic response
[estabilidad,yinf,Test]=additionalinfoFB(GH.num{1,1},GH.den{1,1},AmplitudSP,tFinal,1000);
set(ghWnd.label_Estabilidad, "String", num2str(estabilidad));
set(ghWnd.valor_final, "String", num2str(yinf));
set(ghWnd.tiempo_estab_GH, "String", num2str(Test));

% Zeros and Poles
nGH=GH.num{1,1}; dGH=GH.den{1,1};
[ceros_la, polos_la,KGH]=xzpkdata(nGH,dGH);
Kasteric=KGH;

% Additional information of frequency  response
[mGH,pGH,w]=bode(GH);
% fix the phase wrap arownd
phaud=pGH;
phw=unwrap(phaud*pi/180);
phaud=phw*180/pi;
% delayed plant phase,
%phad=phaud + ((-w.*delay)*180/pi)';
delay=0;

[Kast,Kast_ult,wultimo,GM,wcg,PM]=additionalinfofreq(GH,Kasteric,mGH,phaud,delay,w);
set(ghWnd.Kasterisco, "String", num2str(Kast))
set(ghWnd.Kasterisco_ultimo, "String", num2str(Kast_ult))
set(ghWnd.wu, "String", num2str(wultimo))
set(ghWnd.gain_margin, "String", num2str(GM))
set(ghWnd.w_cg, "String", num2str(wcg))
set(ghWnd.phase_margin, "String", num2str(PM))

end

## @deftypefn  {} {} btn_setdefaultGH_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_setdefaultGH control.
##
## @end deftypefn
function btn_setdefaultGH_doIt(source, callbackdata, ghWnd)


%
% Load default values of G(s)H(s)
%
%

% global variable
global _ltitoolBasePath;

% Complex variable "s"
s=tf('s'); 

% Transfer function
% --------------------------
GH=0.5/(s*(s^2+s+1));
Kr=1.25;

% Simulation data
AmplitudSP=1;
tFinal=30;

% Figure
figuraGH=1;

% Save default data
% ---------------------------
save([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'],'GH','Kr','AmplitudSP','tFinal','figuraGH')


% ------------------------------------------------------------------------
% Reload information to main window
% ------------------------------------------------------------------------
set(ghWnd.numGH,'string',polyout(GH.num{1,1}/Kr)); 
set(ghWnd.denGH,'string',polyout(GH.den{1,1}));
set(ghWnd.Kr,'string',num2str(Kr));
set(ghWnd.AmplitudSP,'string',num2str(AmplitudSP));
set(ghWnd.tFinal,'string',num2str(tFinal));

end

## @deftypefn  {} {} btn_saveGH_doIt (@var{source}, @var{callbackdata}, @var{ghWnd})
##
## Define a callback for default action of btn_saveGH control.
##
## @end deftypefn
function btn_saveGH_doIt(source, callbackdata, ghWnd)


% Save data of:
% 	G(s)H(s) transfer function,
% 	Set-Point  step response (ysim,tsim)
% 	Set-Point step amplitud (AmplitudSP)
% 	Simulation time  (tFinal)
% 	Settling value (yinf)
% 	Settling time (Test)


[fname, fpath, fltidx] = uiputfile ({'.txt','Archivos de texto';'.m', 'Scripts de octave';'.', 'Todos los archivos'}, 'Abrir archivo. Elija un nombre de archivo para abrir');
if(fname)
  % Complex variable "s"
  s = tf('s');

  % Read data from main window
  % -----------------------------------------------------
  % Data from main window, G(s)H(s) and Kr
  Kr = str2num(get(ghWnd.Kr, 'string'));                  % Kr: controller gain
  numGH = get(ghWnd.numGH, 'string');
  denGH = get(ghWnd.denGH, 'string');

  % Built GH transfer function
  sysStrGH = strcat('(',numGH,')', '/','(', denGH,')');
  GH_Kr = tf(eval(sysStrGH));	% Transfer Funtion G(s)H(s) /Kr
  GH=Kr*GH_Kr;			% Transfer Funtion G(s)H(s)

  % Simulation values
  AmplitudSP = str2num(get(ghWnd.AmplitudSP, 'string'));  % k: step amplitud
  tFinal = str2num(get(ghWnd.tFinal, 'string'));          % Tf: simulation time


  % Simulation and Additional Information
  % --------------------------------------------------------
  % Set_Point step response
  nptos=1000;
  [estabilidad,yinf,Test,step_tsim,step_ysim]=additionalinfoFB(GH.num{1,1},GH.den{1,1},AmplitudSP,tFinal,nptos);

  % Impulse Response
  gcl=minreal(feedback(GH));
  DT=tFinal/nptos;
  [imp_ysim,imp_tsim]=impulse(gcl, tFinal,DT); 

  % Zeros-poles additional information
  %GH
  nGH=GH.num{1,1}; dGH=GH.den{1,1};
  [zeros_GH, poles_GH,KGH]=xzpkdata(nGH,dGH);
  % Closed loop
  Gcl = minreal(GH/(1+GH));
  [zeros_cl, poles_cl,Kcl]=xzpkdata(Gcl.num{1,1},Gcl.den{1,1});

  % Frequency response additional information
  Kasteric=KGH;
  [mGH,pGH,w]=bode(GH);
  % fix the phase wrap arownd
  phaud=pGH;
  phw=unwrap(phaud*pi/180);
  phaud=phw*180/pi;
  % delayed plant phase,
  %phad=phaud + ((-w.*delay)*180/pi)';
  delay=0;
  [Kast,Kast_ult,wultimo,GM,wcg,PM]=additionalinfofreq(GH,Kasteric,mGH,phaud,delay,w);


  % Save results
  % --------------------------
  save([fpath fname], 'GH','Gcl', ...
       'zeros_GH', 'poles_GH','KGH','zeros_cl', 'poles_cl','Kcl', ...
       'estabilidad','yinf','Test','tFinal','step_tsim','step_ysim', 'imp_tsim','imp_ysim', ...
       'AmplitudSP','Kast','Kast_ult','wultimo','GM','wcg','PM');
else
  disp('Cancelado');
endif;

end

 
## @deftypefn  {} {@var{ret} = } show_ghWnd()
##
## Create windows controls over a figure, link controls with callbacks and return 
## a window struct representation.
##
## @end deftypefn
function ret = show_ghWnd()
  _scrSize = get(0, "screensize");
  _xPos = (_scrSize(3) - 1200)/2;
  _yPos = 114;
   ghWnd = figure ( ... 
	'Color', [0.949 0.949 0.949], ...
	'Position', [_xPos _yPos 1200 624], ...
	'Resize', 'on', ...
	'windowstyle', 'normal', ...
	'MenuBar', 'none');
  Image_GH = axes( ...
	'Units', 'pixels', ... 
	'parent',ghWnd, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [19 391 459 171]);
  numGH = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [593 496 195 23], ... 
	'String', '', ... 
	'TooltipString', '');
  denGH = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [593 438 192 21], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_2 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [505 474 276 15], ... 
	'String', 'G(s)H(s)/K = ----------------------------------------------', ... 
	'TooltipString', '');
  Label_3 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [813 501 206 15], ... 
	'String', 'bm*s^m+......+b1*s^1+b0 ', ... 
	'TooltipString', '');
  Label_4 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [813 447 206 15], ... 
	'String', 'an*s^n+.....+a1*s^1+a0 ', ... 
	'TooltipString', '');
  btn_GHmap = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [216 344 137 22], ... 
	'String', ' Zeros-Poles Map ', ... 
	'TooltipString', '');
  Label_5 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [500 540 261 18], ... 
	'String', 'Open Loop Transfer Function', ... 
	'TooltipString', '');
  Label_infoGH = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [20 346 189 18], ... 
	'String', 'About G(s)H(s)', ... 
	'TooltipString', '');
  Label_7 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [180 266 136 18], ... 
	'String', 'Simulation', ... 
	'TooltipString', '');
  Label_8 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [175 131 215 18], ... 
	'String', 'Simulation Parameters ', ... 
	'TooltipString', '');
  btn_GHstep = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [180 225 173 25], ... 
	'String', 'Step Response', ... 
	'TooltipString', '');
  btn_GHimp = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [180 185 173 24], ... 
	'String', 'Impulse Response', ... 
	'TooltipString', '');
  AmplitudSP = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [335 92 57 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_9 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [175 96 146 15], ... 
	'String', 'SP Step Amplitude =', ... 
	'TooltipString', '');
  Label_10 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [175 60 146 15], ... 
	'String', 'Simulation Time =', ... 
	'TooltipString', '');
  tFinal = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [335 56 56 22], ... 
	'String', '', ... 
	'TooltipString', '');
  ayudaLA = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [835 7 90 22], ... 
	'String', 'Help', ... 
	'TooltipString', '');
  btn_closeGH = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [1090 7 90 22], ... 
	'String', 'Close', ... 
	'TooltipString', '');
  Label_10 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [266 591 825 23], ... 
	'String', 'Analysis and Simulation of Closed Loop Systems Based on G(s)H(s)', ... 
	'TooltipString', '');
  Image_2 = axes( ...
	'Units', 'pixels', ... 
	'parent',ghWnd, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [448 55 466 314]);
  estabilidad = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 349 76 15], ... 
	'String', 'System:', ... 
	'TooltipString', '');
  Test = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 286 113 15], ... 
	'String', 'Settling Time. = ', ... 
	'TooltipString', '');
  tiempo_estab_GH = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1092 282 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  y_inf = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 314 74 15], ... 
	'String', 'y(inf) =', ... 
	'TooltipString', '');
  valor_final = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1092 312 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_15 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 7, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 268 86 11], ... 
	'String', '(Approximate)', ... 
	'TooltipString', '');
  btn_GHfigs = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [915 347 25 22], ... 
	'String', '+', ... 
	'TooltipString', '');
  label_Estabilidad = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1056 342 126 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_Kr = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [500 404 127 15], ... 
	'String', 'Variable Gain, K =', ... 
	'TooltipString', '');
  Label_analisis = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [20 266 111 18], ... 
	'String', 'Analysis', ... 
	'TooltipString', '');
  btn_RL = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.945 0.941], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [20 227 126 22], ... 
	'String', 'Root Locus', ... 
	'TooltipString', '');
  btn_Bode = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.945 0.941], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [20 186 124 22], ... 
	'String', 'Bode', ... 
	'TooltipString', '');
  btn_Nyquist = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.945 0.941], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [20 147 124 22], ... 
	'String', 'Nyquist', ... 
	'TooltipString', '');
  Label_infoGlc = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [20 311 188 18], ... 
	'String', 'About Closed Loop', ... 
	'TooltipString', '');
  btn_Glcmap = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.945 0.941], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [212 309 139 22], ... 
	'String', ' Zeros-Poles Map ', ... 
	'TooltipString', '');
  Label_19 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 236 72 15], ... 
	'String', '[K*] = ', ... 
	'TooltipString', '');
  Kasterisco = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1092 232 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Kastultimo = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 199 87 15], ... 
	'String', '[K*u] = ', ... 
	'TooltipString', '');
  Kasterisco_ultimo = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1090 197 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_omega_u = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Symbol', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 162 86 27], ... 
	'String', 'w       =', ... 
	'TooltipString', '');
  wu = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1090 162 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_sub_u = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 9, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [980 157 30 17], ... 
	'String', '-180', ... 
	'TooltipString', '');
  Label_GM = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 129 84 15], ... 
	'String', 'GM = ', ... 
	'TooltipString', '');
  gain_margin = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1090 127 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_omega_180 = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Symbol', ... 
	'FontSize', 15, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 92 83 27], ... 
	'String', 'w   = ', ... 
	'TooltipString', '');
  Label_sub_cg = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 9, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [980 85 30 14], ... 
	'String', 'gc', ... 
	'TooltipString', '');
  w_cg = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1090 92 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_PM = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.949 0.949 0.949], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [965 54 86 15], ... 
	'String', 'PM  = ', ... 
	'TooltipString', '');
  phase_margin = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [1090 52 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  btn_infoadicional = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [960 377 165 22], ... 
	'String', 'Additional Information', ... 
	'TooltipString', '');
  btn_setdefaultGH = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [890 537 199 22], ... 
	'String', 'Load Default Values', ... 
	'TooltipString', '');
  btn_saveGH = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'ForegroundColor', [0.000 0.000 0.000], ... 
	'Position', [960 7 90 22], ... 
	'String', 'Save', ... 
	'TooltipString', '');
  Kr = uicontrol( ...
	'parent',ghWnd, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Arial', ... 
	'FontSize', 10, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [630 400 90 22], ... 
	'String', '', ... 
	'TooltipString', '');

  ghWnd = struct( ...
      'figure', ghWnd, ...
      'Image_GH', Image_GH, ...
      'numGH', numGH, ...
      'denGH', denGH, ...
      'Label_2', Label_2, ...
      'Label_3', Label_3, ...
      'Label_4', Label_4, ...
      'btn_GHmap', btn_GHmap, ...
      'Label_5', Label_5, ...
      'Label_infoGH', Label_infoGH, ...
      'Label_7', Label_7, ...
      'Label_8', Label_8, ...
      'btn_GHstep', btn_GHstep, ...
      'btn_GHimp', btn_GHimp, ...
      'AmplitudSP', AmplitudSP, ...
      'Label_9', Label_9, ...
      'Label_10', Label_10, ...
      'tFinal', tFinal, ...
      'ayudaLA', ayudaLA, ...
      'btn_closeGH', btn_closeGH, ...
      'Label_10', Label_10, ...
      'Image_2', Image_2, ...
      'estabilidad', estabilidad, ...
      'Test', Test, ...
      'tiempo_estab_GH', tiempo_estab_GH, ...
      'y_inf', y_inf, ...
      'valor_final', valor_final, ...
      'Label_15', Label_15, ...
      'btn_GHfigs', btn_GHfigs, ...
      'label_Estabilidad', label_Estabilidad, ...
      'Label_Kr', Label_Kr, ...
      'Label_analisis', Label_analisis, ...
      'btn_RL', btn_RL, ...
      'btn_Bode', btn_Bode, ...
      'btn_Nyquist', btn_Nyquist, ...
      'Label_infoGlc', Label_infoGlc, ...
      'btn_Glcmap', btn_Glcmap, ...
      'Label_19', Label_19, ...
      'Kasterisco', Kasterisco, ...
      'Kastultimo', Kastultimo, ...
      'Kasterisco_ultimo', Kasterisco_ultimo, ...
      'Label_omega_u', Label_omega_u, ...
      'wu', wu, ...
      'Label_sub_u', Label_sub_u, ...
      'Label_GM', Label_GM, ...
      'gain_margin', gain_margin, ...
      'Label_omega_180', Label_omega_180, ...
      'Label_sub_cg', Label_sub_cg, ...
      'w_cg', w_cg, ...
      'Label_PM', Label_PM, ...
      'phase_margin', phase_margin, ...
      'btn_infoadicional', btn_infoadicional, ...
      'btn_setdefaultGH', btn_setdefaultGH, ...
      'btn_saveGH', btn_saveGH, ...
      'Kr', Kr);


  set (btn_GHmap, 'callback', {@btn_GHmap_doIt, ghWnd});
  set (btn_GHstep, 'callback', {@btn_GHstep_doIt, ghWnd});
  set (btn_GHimp, 'callback', {@btn_GHimp_doIt, ghWnd});
  set (ayudaLA, 'callback', {@ayudaLA_doIt, ghWnd});
  set (btn_closeGH, 'callback', {@btn_closeGH_doIt, ghWnd});
  set (btn_GHfigs, 'callback', {@btn_GHfigs_doIt, ghWnd});
  set (btn_RL, 'callback', {@btn_RL_doIt, ghWnd});
  set (btn_Bode, 'callback', {@btn_Bode_doIt, ghWnd});
  set (btn_Nyquist, 'callback', {@btn_Nyquist_doIt, ghWnd});
  set (btn_Glcmap, 'callback', {@btn_Glcmap_doIt, ghWnd});
  set (btn_infoadicional, 'callback', {@btn_infoadicional_doIt, ghWnd});
  set (btn_setdefaultGH, 'callback', {@btn_setdefaultGH_doIt, ghWnd});
  set (btn_saveGH, 'callback', {@btn_saveGH_doIt, ghWnd});
  dlg = struct(ghWnd);


% global variable
global _ltitoolBasePath;

%------------------------------------------------------------------------------------------------
% G(s)H(s) image
axes(ghWnd.Image_GH);
imshow([_ltitoolBasePath filesep() 'img' filesep() 'fig_GH.png']);
refresh();

%------------------------------------------------------------------------------------------------
% Load data defined by default
load([_ltitoolBasePath filesep() 'data' filesep() 'loadGHdata'])
%------------------------------------------------------------------------------------------------

% Clear the command window
clc

%------------------------------------------------------------------------------------------------
% Show data inside teh window
set(ghWnd.numGH,'string',polyout(GH.num{1,1}/Kr)); 
set(ghWnd.denGH,'string',polyout(GH.den{1,1}));
set(ghWnd.Kr,'string',num2str(Kr));
set(ghWnd.AmplitudSP,'string',num2str(AmplitudSP));
set(ghWnd.tFinal,'string',num2str(tFinal));
%------------------------------------------------------------------------------------------------


  ret = ghWnd;
end

