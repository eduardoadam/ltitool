%
% Set the graphics toolkit and force read this file as script file (not a function file).
%
graphics_toolkit qt;
%


%
%
% Begin callbacks definitions 
%

function btn_closeCLanalysis_doIt(source, callbackdata, CLanalysis)


% Close window
close(CLanalysis.CLanalysis);

end

function btn_rlocus_CL_doIt(source, callbackdata, CLanalysis)

%
% Plot root locus
%

% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])

% Plot root locus
% ----------------------------------
axes(dlg.ImageLR);
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHrlocusplot(GH.num{1,1},GH.den{1,1},Kr,1000);
hold off

end

function btn_Bode_CL_doIt(source, callbackdata, CLanalysis)


%
% Plot Bode diagrams
%

% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])

% Plot Bode diagrams
% ----------------------------------
axes(dlg.ImageBodeMag);
delay=0;
flagMagPha='gragicoMag';
[Kast,Kast_ult,wultimo,GM,wcg,PM]=bodeplotMagPha(GH.num{1,1},GH.den{1,1},delay,Kr,flagMagPha);
hold off
axes(dlg.ImageBodePha);
flagMagPha='gragicoPha';
[Kast,Kast_ult,wultimo,GM,wcg,PM]=bodeplotMagPha(GH.num{1,1},GH.den{1,1},delay,Kr,flagMagPha);
hold off

end

function btn_Nyquist_CL_doIt(source, callbackdata, CLanalysis)


%
% Plot Nyquist diagram
%

% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])

% Plot Nyquist diagram
% ----------------------------------
axes(dlg.ImageNyq);
delay=0;
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHnyquistplot(GH.num{1,1},GH.den{1,1},delay,Kr);
hold off

end

function btn_GHmap_CL_doIt(source, callbackdata, CLanalysis)

%
% Plot zeros-poles map of open loop transfer function (GH)
%

% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])

% ------------------------------------------------------------------------------------
% Zeros-Poles map of G(s)H(s)
title_string='Poles-Zeros Map of G(s)H(s)';
legend_ceros_string='Zeros of G(s)H(s)';
legend_polos_string='Poles of G(s)H(s)';

% Plot zeros-poles map
% ----------------------------------
axes(dlg.ImageZPGH);
xpzmap(title_string,legend_ceros_string,legend_polos_string,GH.num{1,1},GH.den{1,1});
figuraGH=1;
% ------------------------------------------------------------------------------------

end

function btn_Gclmap_CL_doIt(source, callbackdata, CLanalysis)

%
% Plot zeros-poles map of  closed loop system,  Gcl(s)
%

% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])

%Closed loop transfer function (Gcl)
Gcl = minreal(GH/(1+GH));

% -------------------------------------------------------------------------
% Poles-Zeros map of closed loop system
title_string='Poles-Zeros Map of Gcls)';
legend_ceros_string='Zeros of Gcl(s)';
legend_polos_string='Poles of Gcl(s)';

% Plot zeros-poles map
% ----------------------------------
axes(dlg.ImageZPGLC);
xpzmap(title_string,legend_ceros_string,legend_polos_string,Gcl.num{1,1},Gcl.den{1,1});
figuraGH=2;
% -------------------------------------------------------------------------

%
refresh();

end

function btn_rlocusplus_doIt(source, callbackdata, CLanalysis)


%
% Llama a graficar el lugar de las raices
%

% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])

% Presento grafico
% ----------------------------------
figure
delay=0;
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHrlocusplot(GH.num{1,1},GH.den{1,1},Kr,1000);
axisx=xlabel('Real G(s)H(s)'); axisy=ylabel('Imag. G(s)H(s)');
set(axisx,'fontsize',14);  
set(axisy,'fontsize',14);

end

function btn_Bodeplus_doIt(source, callbackdata, CLanalysis)


%
% Llama a graficar elos diagramas de Bode
%

% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])

% Presento grafico
% ----------------------------------
figure();
delay=0;
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHbodeplot(GH.num{1,1},GH.den{1,1},delay,Kr);
 

end

function btn_Nyqplus_doIt(source, callbackdata, CLanalysis)


%
% Llama a graficar el diagrama de Nyquist
%


% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])


% Presento grafico
% ----------------------------------
figure
delay=0;
[Kast,Kast_ult,wultimo,GM,wcg,PM]=GHnyquistplot(GH.num{1,1},GH.den{1,1},delay,Kr);

end

 
%
% Dialog creation windows function 
%
function ret = show_CLanalysis()
  _scrSize = get(0, "screensize");
  _xPos = (_scrSize(3) - 1189)/2;
  _yPos = (_scrSize(4) - 673)/2;
   CLanalysis = figure ( ... 
	'Color', [0.961 0.965 0.969], ...
	'Position', [_xPos _yPos 1189 673], ...
	'Resize', 'on', ...
	'windowstyle', 'normal', ...
	'MenuBar', 'none');
  GCLanalysis = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 13, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [400 643 297 20], ... 
	'String', 'Analysis Tools for Feedback Systems', ... 
	'TooltipString', '');
  btn_closeCLanalysis = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [1067 16 90 22], ... 
	'String', 'Close', ... 
	'TooltipString', '');
  btn_rlocus_CL = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [40 375 137 23], ... 
	'String', 'Root Locus', ... 
	'TooltipString', '');
  btn_Bode_CL = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [420 375 137 23], ... 
	'String', 'Bode', ... 
	'TooltipString', '');
  btn_Nyquist_CL = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [810 375 136 23], ... 
	'String', 'Nyquist', ... 
	'TooltipString', '');
  Label_2 = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [40 411 188 17], ... 
	'String', 'Analysis Based on G(s)H(s)', ... 
	'TooltipString', '');
  Label_3 = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [40 581 119 17], ... 
	'String', 'Poles-Zeros Map', ... 
	'TooltipString', '');
  btn_GHmap_CL = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [40 541 243 22], ... 
	'String', 'Poles-Zeros of G(s)H(s)', ... 
	'TooltipString', '');
  btn_Gclmap_CL = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [40 501 239 22], ... 
	'String', 'Poles-Zeros of Closed Loop', ... 
	'TooltipString', '');
  ImageZPGH = axes( ...
	'Units', 'pixels', ... 
	'parent',CLanalysis, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [425 456 301 144]);
  ImageLR = axes( ...
	'Units', 'pixels', ... 
	'parent',CLanalysis, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [40 74 298 259]);
  ImageBodeMag = axes( ...
	'Units', 'pixels', ... 
	'parent',CLanalysis, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [425 239 305 94]);
  ImageBodePha = axes( ...
	'Units', 'pixels', ... 
	'parent',CLanalysis, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [425 76 304 92]);
  ImageNyq = axes( ...
	'Units', 'pixels', ... 
	'parent',CLanalysis, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [810 73 305 260]);
  btn_rlocusplus = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [340 316 42 22], ... 
	'String', '+', ... 
	'TooltipString', '');
  btn_Bodeplus = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [730 316 43 22], ... 
	'String', '+', ... 
	'TooltipString', '');
  btn_Nyqplus = uicontrol( ...
	'parent',CLanalysis, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.961 0.965 0.969], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [1115 316 42 22], ... 
	'String', '+', ... 
	'TooltipString', '');
  ImageZPGLC = axes( ...
	'Units', 'pixels', ... 
	'parent',CLanalysis, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [815 454 302 149]);

  CLanalysis = struct( ...
      'figure', CLanalysis, ...
      'GCLanalysis', GCLanalysis, ...
      'btn_closeCLanalysis', btn_closeCLanalysis, ...
      'btn_rlocus_CL', btn_rlocus_CL, ...
      'btn_Bode_CL', btn_Bode_CL, ...
      'btn_Nyquist_CL', btn_Nyquist_CL, ...
      'Label_2', Label_2, ...
      'Label_3', Label_3, ...
      'btn_GHmap_CL', btn_GHmap_CL, ...
      'btn_Gclmap_CL', btn_Gclmap_CL, ...
      'ImageZPGH', ImageZPGH, ...
      'ImageLR', ImageLR, ...
      'ImageBodeMag', ImageBodeMag, ...
      'ImageBodePha', ImageBodePha, ...
      'ImageNyq', ImageNyq, ...
      'btn_rlocusplus', btn_rlocusplus, ...
      'btn_Bodeplus', btn_Bodeplus, ...
      'btn_Nyqplus', btn_Nyqplus, ...
      'ImageZPGLC', ImageZPGLC);


  set (btn_closeCLanalysis, 'callback', {@btn_closeCLanalysis_doIt, CLanalysis});
  set (btn_rlocus_CL, 'callback', {@btn_rlocus_CL_doIt, CLanalysis});
  set (btn_Bode_CL, 'callback', {@btn_Bode_CL_doIt, CLanalysis});
  set (btn_Nyquist_CL, 'callback', {@btn_Nyquist_CL_doIt, CLanalysis});
  set (btn_GHmap_CL, 'callback', {@btn_GHmap_CL_doIt, CLanalysis});
  set (btn_Gclmap_CL, 'callback', {@btn_Gclmap_CL_doIt, CLanalysis});
  set (btn_rlocusplus, 'callback', {@btn_rlocusplus_doIt, CLanalysis});
  set (btn_Bodeplus, 'callback', {@btn_Bodeplus_doIt, CLanalysis});
  set (btn_Nyqplus, 'callback', {@btn_Nyqplus_doIt, CLanalysis});
  dlg = struct(CLanalysis);



% global variable
global _basePath;

%
% Load predefined data
% --------------------------------
load([_basePath filesep() 'data' filesep() 'loadCLdata'])












































  ret = CLanalysis;
end

