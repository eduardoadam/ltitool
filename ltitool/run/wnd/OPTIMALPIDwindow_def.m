%
% Set the graphics toolkit and force read this file as script file (not a function file).
%
graphics_toolkit qt;
%


%
%
% Begin callbacks definitions 
%

function btn_closeOptimalPID_doIt(source, callbackdata, OPTIMALPIDwindow)

% This code will be executed when user click the button control.
% As default, all events are deactivated, to activate must set the
% propertie 'have callback' from the properties editor

% Close Optimal PID windown
close(dlg.OPTIMALPIDwindow);

end

function btn_help_optm_doIt(source, callbackdata, OPTIMALPIDwindow)


%
% Run presentation to help  as html file.
%

% global variable
global _basePath;

% Load html file
url = ["file:" _basePath filesep() "ltitool_manual" filesep() "ltitool_manual.html"];

  if(isunix())
    system(["xdg-open " url]);
  elseif (ispc())
    system(["start " url]);
  else
    disp(["I don't know how to open " url " in your os. Sorry!"]);
  endif;

end

function btn_runOPTMPID_doIt(source, callbackdata, OPTIMALPIDwindow)


%
% Load default values for optimal PID window
%

% global variable
global _basePath;

%------------------------------------------------------------------------------------------------
% Data from main window
% Complex variable "s"
s = tf('s');
% Built Gp(s) transfer function
numGp = get(dlg.numGp, 'string');
denGp = get(dlg.denGp, 'string');
sysStrGH = strcat('(',numGp,')', '/','(', denGp,')');
Gp = minreal(tf(eval(sysStrGH)));

% Proposed controller
Kr = str2num(get(dlg.Kr, 'string'));
TI = str2num(get(dlg.TI, 'string'));
TD = str2num(get(dlg.TD, 'string'));
% Function weight
wITAE = str2num(get(dlg.wITAE, 'string'));
wOVS = str2num(get(dlg.wOVS, 'string'));
wS = str2num(get(dlg.wS, 'string'));
%------------------------------------------------------------------------------------------------


% PROVISORIO !!!!!
Ts=0.1; tFinal=30

% Global Variables
global P dt mu_1 mu_2 mu_3
P=Gp; mu_1=wITAE; mu_2=wOVS; mu_3=wS; dt=Ts;

% Run optimization routine
scrSize = get(0, "screensize");
xPos = (scrSize(3) - 180)/2;
yPos = (scrSize(4) - 70)/2;
wh = waitbar(0.3, 'Calculating', 'Position',[xPos yPos 180 70]);
[Kropt,TIopt, TDopt]=xoptiPID(Kr,TI,TD,Gp,tFinal,Ts,wITAE,wOVS,wS);
close(wh); % Close calculating window

% ------------------------------------------------------------------------
% Reload information to main window
% ------------------------------------------------------------------------
set(OPTIMALPIDwindow.Kropt,'string',num2str(Kropt));
set(OPTIMALPIDwindow.TIopt,'string',num2str(TIopt));
set(OPTIMALPIDwindow.TDopt,'string',num2str(TDopt));
% ------------------------------------------------------------------------
end

function btn_setdefaultOPTMPID_doIt(source, callbackdata, OPTIMALPIDwindow)


%
% Load default values for optimal PID window
%
%

% global variable
global _basePath;

% Complex variable "s"
s=tf('s'); 

% Transfer function
% --------------------------
Gp=10/(s^3+6*s^2+11*s+6);

% Controllers
% Proposed controller
Kr=1.00000; TI=1.00000; TD=0.00000;
% Optimal controller
Kropt=1; TIopt=1; TDopt=0;

% Simulation data
Ts=0.1;     %sample time
tFinal=10;  %simulation time

% Function weight
wITAE=1;
wOVS=10;
wS=20;

% Save default data
% ---------------------------
save([_basePath filesep() 'data' filesep() 'loadOPTMPIDdata'],'Gp','Kr','TI','TD', ...
                          'Kropt','TIopt','TDopt','Ts','tFinal','wITAE','wOVS','wS')

% ------------------------------------------------------------------------
% Reload information to main window
% ------------------------------------------------------------------------
set(OPTIMALPIDwindow.numGp,'string',polyout(Gp.num{1,1})); 
set(OPTIMALPIDwindow.denGp,'string',polyout(Gp.den{1,1}));
set(OPTIMALPIDwindow.Kr,'string',num2str(Kr));
set(OPTIMALPIDwindow.TI,'string',num2str(TI));
set(OPTIMALPIDwindow.TD,'string',num2str(TD));
set(OPTIMALPIDwindow.Kropt,'string',num2str(Kropt));
set(OPTIMALPIDwindow.TIopt,'string',num2str(TIopt));
set(OPTIMALPIDwindow.TDopt,'string',num2str(TDopt));
set(OPTIMALPIDwindow.wITAE,'string',num2str(wITAE));
set(OPTIMALPIDwindow.wOVS,'string',num2str(wOVS));
set(OPTIMALPIDwindow.wS,'string',num2str(wS));
% ------------------------------------------------------------------------

end

 
%
% Dialog creation windows function 
%
function ret = show_OPTIMALPIDwindow()
  _scrSize = get(0, "screensize");
  _xPos = (_scrSize(3) - 840)/2;
  _yPos = (_scrSize(4) - 595)/2;
   OPTIMALPIDwindow = figure ( ... 
	'Color', [0.937 0.922 0.906], ...
	'Position', [_xPos _yPos 840 595], ...
	'Resize', 'on', ...
	'windowstyle', 'normal', ...
	'MenuBar', 'none');
  btn_closeOptimalPID = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [721 8 90 22], ... 
	'String', 'Close', ... 
	'TooltipString', '');
  Label_189 = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 18, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [288 557 345 28], ... 
	'String', 'Optimal PID Controller Tuning', ... 
	'TooltipString', '');
  Label_190 = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [425 458 248 17], ... 
	'String', 'G(s) = ----------------------------------------------', ... 
	'TooltipString', '');
  Label_191 = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [420 528 42 17], ... 
	'String', 'Plant:', ... 
	'TooltipString', '');
  numGp = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [475 478 190 22], ... 
	'String', '', ... 
	'TooltipString', '');
  denGp = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [470 428 197 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_192 = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [10 383 438 17], ... 
	'String', 'Adopt the parameters of a PID controller and enter its modes', ... 
	'TooltipString', '');
  PID_label = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [10 353 144 17], ... 
	'String', 'C(s)=Kr(1+1/TIs+TDs)', ... 
	'TooltipString', '');
  Mode_P = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','checkbox', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [10 303 52 17], ... 
	'String', 'P Mode', ... 
	'TooltipString', '', ... 
	'Min', 0, 'Max', 1, 'Value', 1);
  TI = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','checkbox', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [205 303 47 17], ... 
	'String', 'I Mode', ... 
	'TooltipString', '', ... 
	'Min', 0, 'Max', 1, 'Value', 1);
  Mode_D = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','checkbox', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [400 303 53 17], ... 
	'String', 'D Mode', ... 
	'TooltipString', '', ... 
	'Min', 0, 'Max', 1, 'Value', 1);
  Kr = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [95 301 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  TI = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [285 301 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  TD = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [490 301 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Label_194 = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [5 263 517 17], ... 
	'String', 'The optimal controller calculation strongly depends on the initial conditions.', ... 
	'TooltipString', '');
  Label_195 = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [5 243 595 17], ... 
	'String', 'Be sure to correctly initialize the chosen controller to determine its optimal parameters.', ... 
	'TooltipString', '');
  Label_196 = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'bold', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [5 203 128 17], ... 
	'String', 'Weight Functions:', ... 
	'TooltipString', '');
  W_ITA_label = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [160 203 158 17], ... 
	'String', 'Minimize ITAE Criterion', ... 
	'TooltipString', '');
  wITAE = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [385 201 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  W_OVS_label = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [160 168 207 17], ... 
	'String', 'Minimize Maximum Overshoot', ... 
	'TooltipString', '');
  wOVS = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [385 166 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  W_S_label = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [160 128 197 17], ... 
	'String', 'Minimize Function Sensitivity', ... 
	'TooltipString', '');
  wS = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [385 126 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  Kr_label = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [120 68 19 17], ... 
	'String', 'Kr:', ... 
	'TooltipString', '');
  Kropt = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [150 66 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  TI_label = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [275 68 16 17], ... 
	'String', 'TI:', ... 
	'TooltipString', '');
  TIopt = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [305 66 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  TD_label = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','text', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [420 68 23 17], ... 
	'String', 'TD:', ... 
	'TooltipString', '');
  TDopt = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','edit', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [1.000 1.000 1.000], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'HorizontalAlignment', 'left', ... 
	'Position', [455 66 90 22], ... 
	'String', '', ... 
	'TooltipString', '');
  btn_analysis_otpm = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [690 208 129 22], ... 
	'String', 'Analysis Tools', ... 
	'TooltipString', '');
  btn_sim_optm = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [690 168 125 22], ... 
	'String', 'Simulation', ... 
	'TooltipString', '');
  btn_help_optm = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [15 8 125 22], ... 
	'String', 'Help', ... 
	'TooltipString', '');
  btn_runOPTMPID = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [5 66 90 22], ... 
	'String', 'Optimal PID', ... 
	'TooltipString', '');
  btn_setdefaultOPTMPID = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [682 508 144 22], ... 
	'String', 'Load Default Values', ... 
	'TooltipString', '');
  optmPID_image = axes( ...
	'Units', 'pixels', ... 
	'parent',OPTIMALPIDwindow, ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [15 412 395 133]);
  btn_saveOPTMPID = uicontrol( ...
	'parent',OPTIMALPIDwindow, ... 
	'Style','pushbutton', ... 
	'Units', 'pixels', ... 
	'BackgroundColor', [0.937 0.922 0.906], ... 
	'FontAngle', 'normal', ... 
	'FontName', 'Ubuntu', ... 
	'FontSize', 11, 'FontUnits', 'points', ... 
	'FontWeight', 'normal', ... 
	'Position', [605 8 90 22], ... 
	'String', 'Save', ... 
	'TooltipString', '');

  OPTIMALPIDwindow = struct( ...
      'figure', OPTIMALPIDwindow, ...
      'btn_closeOptimalPID', btn_closeOptimalPID, ...
      'Label_189', Label_189, ...
      'Label_190', Label_190, ...
      'Label_191', Label_191, ...
      'numGp', numGp, ...
      'denGp', denGp, ...
      'Label_192', Label_192, ...
      'PID_label', PID_label, ...
      'Mode_P', Mode_P, ...
      'TI', TI, ...
      'Mode_D', Mode_D, ...
      'Kr', Kr, ...
      'TI', TI, ...
      'TD', TD, ...
      'Label_194', Label_194, ...
      'Label_195', Label_195, ...
      'Label_196', Label_196, ...
      'W_ITA_label', W_ITA_label, ...
      'wITAE', wITAE, ...
      'W_OVS_label', W_OVS_label, ...
      'wOVS', wOVS, ...
      'W_S_label', W_S_label, ...
      'wS', wS, ...
      'Kr_label', Kr_label, ...
      'Kropt', Kropt, ...
      'TI_label', TI_label, ...
      'TIopt', TIopt, ...
      'TD_label', TD_label, ...
      'TDopt', TDopt, ...
      'btn_analysis_otpm', btn_analysis_otpm, ...
      'btn_sim_optm', btn_sim_optm, ...
      'btn_help_optm', btn_help_optm, ...
      'btn_runOPTMPID', btn_runOPTMPID, ...
      'btn_setdefaultOPTMPID', btn_setdefaultOPTMPID, ...
      'optmPID_image', optmPID_image, ...
      'btn_saveOPTMPID', btn_saveOPTMPID);


  set (btn_closeOptimalPID, 'callback', {@btn_closeOptimalPID_doIt, OPTIMALPIDwindow});
  set (btn_help_optm, 'callback', {@btn_help_optm_doIt, OPTIMALPIDwindow});
  set (btn_runOPTMPID, 'callback', {@btn_runOPTMPID_doIt, OPTIMALPIDwindow});
  set (btn_setdefaultOPTMPID, 'callback', {@btn_setdefaultOPTMPID_doIt, OPTIMALPIDwindow});
  dlg = struct(OPTIMALPIDwindow);


%
% OTPIMAL PID CONTROLLER TUNING main window
%


% global variable
global _basePath;

%------------------------------------------------------------------------------------------------
% G(s)H(s) image
axes(OPTIMALPIDwindow.optmPID_image);
imshow([_basePath filesep() 'img' filesep() 'figoptmPID.png']);
refresh();

%------------------------------------------------------------------------------------------------
% Load data defined by default
load([_basePath filesep() 'data' filesep() 'loadOPTMPIDdata'])
%------------------------------------------------------------------------------------------------

% Clear the command window
clc

%------------------------------------------------------------------------------------------------
% Show data inside teh window
set(OPTIMALPIDwindow.numGp,'string',polyout(Gp.num{1,1})); 
set(OPTIMALPIDwindow.denGp,'string',polyout(Gp.den{1,1}));
set(OPTIMALPIDwindow.Kr,'string',num2str(Kr));
set(OPTIMALPIDwindow.TI,'string',num2str(TI));
set(OPTIMALPIDwindow.TD,'string',num2str(TD));
set(OPTIMALPIDwindow.Kropt,'string',num2str(Kropt));
set(OPTIMALPIDwindow.TIopt,'string',num2str(TIopt));
set(OPTIMALPIDwindow.TDopt,'string',num2str(TDopt));
set(OPTIMALPIDwindow.wITAE,'string',num2str(wITAE));
set(OPTIMALPIDwindow.wOVS,'string',num2str(wOVS));
set(OPTIMALPIDwindow.wS,'string',num2str(wS));
%------------------------------------------------------------------------------------------------











  ret = OPTIMALPIDwindow;
end

